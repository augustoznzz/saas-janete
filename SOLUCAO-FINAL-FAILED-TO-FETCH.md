# üîß Solu√ß√£o Definitiva para o Erro "Failed to fetch"

## üéØ Problema Encontrado

O erro "Failed to fetch" ocorre porque:

1. O Netlify Dev est√° carregando vari√°veis de ambiente do site configurado no Netlify
2. A vari√°vel `NEXT_PUBLIC_IDENTITY_GOTRUE_URL` est√° configurada como `http://localhost:9999/.netlify/identity`
3. O Next.js compila essa vari√°vel no c√≥digo em tempo de build
4. O cache do Next.js est√° muito persistente

## ‚úÖ Solu√ß√£o (SIGA EXATAMENTE ESTES PASSOS)

### Passo 1: Pare TODOS os processos Node.js

Abra o PowerShell como **Administrador** e execute:

```powershell
Get-Process node -ErrorAction SilentlyContinue | Stop-Process -Force
```

### Passo 2: Limpe TODOS os caches

No mesmo PowerShell (ainda como Admin):

```powershell
cd E:\projetos\janetezuanazzi
Remove-Item -Path "janetezuanazzi\.next" -Recurse -Force -ErrorAction SilentlyContinue
Remove-Item -Path ".netlify\functions-serve" -Recurse -Force -ErrorAction SilentlyContinue
Remove-Item -Path ".netlify\blobs-serve" -Recurse -Force -ErrorAction SilentlyContinue
```

### Passo 3: Deslinque o site do Netlify (IMPORTANTE!)

Execute:

```powershell
npx netlify unlink
```

Isso vai remover as vari√°veis de ambiente que est√£o causando o problema.

### Passo 4: Inicie o servidor

Agora execute:

```powershell
npm run dev
```

### Passo 5: Aguarde e Teste

1. Aguarde ver a mensagem: **"‚óà Server now ready on http://localhost:8888"**
2. Abra o navegador em **http://localhost:8888/criar-conta**
3. **IMPORTANTE:** Pressione **Ctrl+Shift+R** (ou Cmd+Shift+R no Mac) para recarregar sem cache
4. Preencha o formul√°rio e teste

## üîÑ Se AINDA N√ÉO FUNCIONAR

Se ap√≥s seguir todos os passos acima o erro persistir, existe uma solu√ß√£o alternativa:

### Op√ß√£o Alternativa: Usar Netlify Identity do site em produ√ß√£o

Em vez de usar o Identity local, voc√™ pode usar o Identity do seu site no Netlify:

1. V√° para https://app.netlify.com
2. Acesse seu site
3. V√° em "Site configuration" ‚Üí "Identity"
4. Se n√£o estiver habilitado, clique em "Enable Identity"
5. Copie a URL do seu site (exemplo: `https://seu-site.netlify.app`)

6. Crie um arquivo chamado `.env.local` na pasta \*\*E:\projetos\janetezuanazzi\janetezuanazzi\*\* com:

```
NEXT_PUBLIC_IDENTITY_GOTRUE_URL=https://seu-site.netlify.app/.netlify/identity
```

7. Reinicie o servidor

**ATEN√á√ÉO:** Com esta configura√ß√£o, os usu√°rios criados ser√£o registrados no Netlify Identity do seu site em produ√ß√£o, n√£o localmente.

## üìù Por que o problema estava acontecendo?

O Netlify Dev carrega vari√°veis de ambiente do site linkado no Netlify. A vari√°vel `NEXT_PUBLIC_IDENTITY_GOTRUE_URL` estava configurada para `http://localhost:9999`, que √© provavelmente de uma configura√ß√£o anterior ou de outro projeto.

Vari√°veis que come√ßam com `NEXT_PUBLIC_` no Next.js s√£o incorporadas no c√≥digo JavaScript durante a compila√ß√£o, por isso o cache era t√£o persistente.

## ‚ú® C√≥digo Foi Corrigido

O c√≥digo do arquivo `janetezuanazzi\src\lib\identity.ts` foi modificado para:

- Sempre usar `window.location.origin` em runtime
- Calcular a URL dinamicamente dentro das fun√ß√µes
- N√£o depender de vari√°veis de ambiente em tempo de compila√ß√£o

Agora, mesmo que haja vari√°veis de ambiente configuradas, o c√≥digo vai usar a porta atual do navegador.

## üöÄ Pr√≥ximos Passos

Ap√≥s conseguir criar uma conta:

1. Verifique no Netlify Identity se o usu√°rio foi criado
2. Teste fazer login
3. Verifique se o dashboard do aluno funciona

## üí° Dica para Desenvolvimento

Para evitar esse problema no futuro:

- Sempre use `npm run dev` (que chama `netlify dev`)
- Sempre acesse via `http://localhost:8888`
- Nunca acesse diretamente `http://localhost:3001`
- Se mudar de projeto, execute `netlify unlink` antes

---

**Se seguir estes passos exatamente, o problema ser√° resolvido! üéâ**
